# Illumulus RAG Component 

The main purpose of this directory is to manage files related to adding a RAG Component to Illumulus.
<br />
This project focuses currently on the retrieval of the named entities present in the title entered by the user. A retrieval then is performed on these named entities 
from wikipedia and this additional context is augmented into the prompt that is used for story generation. This was done for both the languages featured in Illumulus, namely German and English.
<br />
<br />
Along with story generation, There were improvements made for the diffusion model to generate more entity-related images. 
Our current approach uses these extracted entities to be sent down directly into the prompt for the diffusion model. 


# QueryNERWiki Python file: 

For the development of the entity extraction of the RAG component, We have tried using the LLM as a named entity extractor. In this,
we have used the story titles that were given to illumulus in the previous year to generate stories. All the entities extracted by the LLM for these 
titles are stored into the [Entities_From_Illumulus_Story_Titles.json](Entities_From_Illumulus_Story_Titles.json)
 file.

# Webis-qinc-22 directory: 

In this directory different NER methods are evaluated to later on use in Illumulus. For this, the [webis-qinc-22.json](webis-qinc-22%2Fwebis-qinc-22.json) 
is used as the ground truth for NER evaluation.
The Webis Query Interpretation Corpus 2022 (Webis-QInC-22) contains manually selected explicit entities, implicit entities and entity based interpretations for 2,800 web queries. These web queries were either obtained from existing entity linking datasets or ambiguity queries from various sources.
after using different NER methods, namely 
<br /> i) The LLM
<br /> ii) The en_core_web_sm, i.e, the small NER spacy model
<br /> iii) The en_core_web_trf, i.e, the transformer based NER spacy model
<br />
<br />
Using the [comparison-evaluation.py](webis-qinc-22%2Fcomparison-evaluation.py) script, we found that the spacy's transformer based model 
had the best numbers.

# Illumulus_story_titles file: 

To understand the kind of story titles Illumulus would receive, we have used the [illumulus_story_titles.json](illumulus_story_titles.json). It
includes extracted story titles from over 200 PDF story files generated by Illumulus in the Open Lab Night 2023. 

# Illumulus_story_generatiion_RAGmodule

This directory tries to emulate the story generation pipeline used in Illumulus. All the previously used and understood methods are put in here
for
<br /> i) NER from the title entered by the user.
<br /> ii) Retrieving wikipedia summaries for the recognized named entities.
<br /> iii) Integrating all the retrieved data into the prompt of the LLM to generate stories more relevant to the 
recognized entities in the story title.

# Future Work 

Towards the end of the project, we had started some work for generating images that are more relevant to the 
recognized named entities in the title. Currently, there is a major improvement in the pictures generated by our diffusion model by simply giving the 
diffusion model the named entities in its prompt. 
<br />
<br />
Adding to this, we had recognized that giving the model images as 'context' may have better results
by experimenting, we found that in the file Illumulus-demo/stable-diffusion-docker/src/python/XL_Apply_InversionCLI.py, In the Illumulus-RAG
repository, There exists a base model and a refiner model. By omitting the base model, and passing a retrieved image, using the recognized named entity from the 
title entered by the user, directly into the refiner model, the model can generate images that closely resemble the input image (source: https://discuss.huggingface.co/t/sdxl-image-to-image-howto/54624).
<br />
<br />
Another challenge we faced and have not overcome is the image retrieval for this task. There seems to be many sources for retrieval (google images, bing images) of images
 but, they all have a certain cap on the number of images retrieved which is not feasible for a tool like Illumulus to run with.
There are other free tools with no caps but the images retrieved from those seem to have not much relevant information present in them.
Another thing we tried was scraping images directly from the wikipedia page of the entity. This seems to have funny results because it would run well for 
named entities such as people. but when other kinds of named entities are used, It retrieves the wrong kind of images from wikipedia. For example, if the entity is a country, it would scrape the flag of the country 
and that has no relevance for the generated image we have.
